<% score = count = rank = rank_ = highest = 0 -%>
[
<% @series.each do |serie| -%>
[<%= serie.id -%>
<% rank += 1 -%>
<% /純得点\:\s(\d+)　補正後得点\:\s(\-?\d+)　重複数\:\s(\d+)$/ =~serie.url -%>
<% rank_ = rank unless score == $2 && count == $3 && highest == (h =  (31 - serie.ranks.where(:ranking_id => 1).minimum(:rank))) -%>
<% score = $2; count = $3; highest = h -%>
,<%= rank_ -%>,<%= score -%>
],<% serie.name -%>
<% serie.authors.map{|a| a.name}.join("・") if serie.authors -%>
<% serie.magazines.select("DISTINCT name").map{|m| m.name}.join("・") if serie.magazines -%>
<% serie.ranks.sort{|a, b| (a.ranking_id <=> b.ranking_id).nonzero? || a.rank <=> b.rank}.map{|r| "#{r.user.name}(#{r.ranking_id == 2 ? "糞" : nil}#{r.rank}位)"}.join(" ") -%>
<% end -%>
]
